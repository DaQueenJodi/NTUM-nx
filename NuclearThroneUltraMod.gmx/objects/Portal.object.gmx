<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprPortalSpawn</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-8</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>image_speed = 0.4

endgame = 100

snd_play(sndPortalOpen)
snd_loop(sndPortalLoop)


var chance = 1;


if instance_exists(Player)
{
if Player.race=22//Rogue
{
repeat(irandom(3))
instance_create(x,y,IDPDSpawn);
}

if Player.race=15//atom extra chance for invertedness and bosses ofcourse aswell
chance=2;

with projectile
{
if team != Player.team
instance_destroy()
}
currentarea=Player.area;
currentsubarea=Player.subarea;

}
else
{
currentarea=BackCont.area;
currentsubarea=BackCont.subarea;
}

type=1;

instance_create(x,y,PortalShock);

inverted=false;//is this an inverted portal?

instance_create(x,y,WallBreak)
instance_create(x+16,y+16,WallBreak)
instance_create(x-16,y-16,WallBreak)

instance_create(x-16,y+16,WallBreak)
instance_create(x+16,y-16,WallBreak)


if ( (currentarea=105 || currentarea=106|| currentarea=107 || currentarea = 108 || currentarea = 109 || currentarea = 112) &amp;&amp; currentsubarea &lt; 2 &amp;&amp; random(5) &lt; chance )//inverted bosses
{
inverted=true;
if instance_exists(Player)
{
Player.inverted=true;
}
with Corpse
canspawnportal=false;
}

pullstrength=2;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with Player
{
area=other.currentarea;

}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if inverted
{
with Player
{
if area=1
area = 105;
}

instance_create(x,y,WallBreak);

alarm[1]=5;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if instance_exists(Player)
{
if Player.x &lt; x
image_xscale = -1
else
image_xscale = 1

if sprite_index = sprPortal or sprite_index = sprProtoPortal or sprite_index = sprPortalInverted
{
with WepPickup
{
if point_distance(x,y,Portal.x,Portal.y) &lt; 96 and collision_line(x,y,Portal.x,Portal.y,Wall,0,0) &lt; 0
{
if place_free(x+lengthdir_x(other.pullstrength,point_direction(x,y,Portal.x,Portal.y)),y)
x += lengthdir_x(other.pullstrength,point_direction(x,y,Portal.x,Portal.y))
if place_free(x,y+lengthdir_y(other.pullstrength,point_direction(x,y,Portal.x,Portal.y)))
y += lengthdir_y(other.pullstrength,point_direction(x,y,Portal.x,Portal.y))
image_angle -= 15*rotspeed

if point_distance(x,y,Portal.x,Portal.y) &lt; 48
persistent=true;
}
}

with Player
{
if point_distance(x,y,Portal.x,Portal.y) &lt; 44 and collision_line(x,y,Portal.x,Portal.y,Wall,0,0) &lt; 0
{
if place_free(x+lengthdir_x(other.pullstrength,point_direction(x,y,Portal.x,Portal.y)),y)
x += lengthdir_x(other.pullstrength,point_direction(x,y,Portal.x,Portal.y))
if place_free(x,y+lengthdir_y(other.pullstrength,point_direction(x,y,Portal.x,Portal.y)))
y += lengthdir_y(other.pullstrength,point_direction(x,y,Portal.x,Portal.y))
angle -= 30*right
sprite_index = spr_hurt
depth = -9
image_index = 1
}
else if point_distance(x,y,Portal.x,Portal.y) &lt; 96 and collision_line(x,y,Portal.x,Portal.y,Wall,0,0) &lt; 0
{
if place_free(x+lengthdir_x(other.pullstrength*0.6,point_direction(x,y,Portal.x,Portal.y)),y)
x += lengthdir_x(other.pullstrength*0.6,point_direction(x,y,Portal.x,Portal.y))
if place_free(x,y+lengthdir_y(other.pullstrength*0.6,point_direction(x,y,Portal.x,Portal.y)))
y += lengthdir_y(other.pullstrength*0.6,point_direction(x,y,Portal.x,Portal.y))
angle -= 30*right
sprite_index = spr_hurt
depth = -9
image_index = 1
}
else if roll = 0
angle = 0
}
}
if point_distance(x,y,Player.x,Player.y)&lt;64
Player.alarm[3]=10;
}

if endgame &lt; 100
{
endgame -= 1
if endgame &lt; 0 and (sprite_index = sprPortal or sprite_index = sprProtoPortal or sprite_index = sprPortalInverted)
{
image_index = 0
if type = 1
{
sprite_index = sprPortalDisappear
if inverted
sprite_index= sprPortalInvertedDisappear
}
if type = 3
sprite_index = sprProtoPortalDisappear
with Player
{
visible = 0
roll = 0
angle = 0
}
}
}
if !instance_exists(Player)
{
endgame = -1
if endgame &lt; 0 and (sprite_index = sprPortal or sprite_index = sprProtoPortal or sprite_index = sprPortalInverted)
{
image_index = 0
if type = 1
{
sprite_index = sprPortalDisappear
if inverted
sprite_index=sprPortalInvertedDisappear;
}
if type = 3
sprite_index = sprProtoPortalDisappear
}
}

pullstrength+=0.04;

if pullstrength&gt;4.5
pullstrength=4.5;

if inverted
pullstrength*=0.9;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="enemy">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with other
{
motion_add(point_direction(x,y,other.x,other.y,)+180,speed+1);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="Player">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if sprite_index != sprPortalSpawn
{
if endgame = 100
{
snd_play(sndPortalClose);
endgame = 30;

//ROBOT
    if Player.race = 8
    {
    if (Player.ultra_got[29]==1||Player.ultra_got[30]==1||Player.ultra_got[31]==1||Player.ultra_got[32]==1)
    {
    with WepPickup
    {
    if curse != 1&amp;&amp;persistent==false
    {
    if string_copy(name,0,4) = "GOLD"
    {repeat(4)
    {if random(Player.maxhealth) &gt; Player.my_health and Player.crown != 2
    instance_create(x,y,HPPickup)
    else
    instance_create(Player.x,Player.y,AmmoPickup)}}
    with instance_create(Player.x,Player.y,RobotEat)
    image_xscale = Player.right
    
    if random(Player.maxhealth) &gt; Player.my_health and Player.crown != 2
    instance_create(Player.x,Player.y,HPPickup)
    else
    instance_create(Player.x,Player.y,AmmoPickup)
    
    if Player.skill_got[5] = 1
    {
    snd_play(sndRobotEatUpg)
    instance_create(Player.x,Player.y,AmmoPickup)
    }
    else
    snd_play(sndRobotEat)
    instance_destroy();
    }
    }
    instance_create(Player.x,Player.y,Smoke)
    }} 
    

}
}
if inverted{
with other
inverted=true//take me to the inverted universe
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="Wall">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with other
{
instance_destroy()
instance_create(x,y,FloorExplo)
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="7">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if sprite_index = sprPortalSpawn
{
//instance_create(x,y,PortalShock);
if type = 1
{
sprite_index = sprPortal
if inverted
sprite_index = sprPortalInverted
}
if type = 3
sprite_index = sprProtoPortal
}
if sprite_index = sprPortalDisappear or sprite_index = sprProtoPortalDisappear or sprite_index = sprPortalInvertedDisappear
{
with Player
{
reload = 0
breload = 0
}
audio_stop_sound(sndPortalLoop)
room_restart()
instance_destroy()
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="73">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Portal position indication for the player
if !(x &gt; view_xview and x &lt; view_xview+view_wview and y &gt; view_yview and y &lt; view_yview+view_hview) &amp;&amp; instance_exists(Player)
{//Am I within the view of the playa

var xx=x;
var yy=y;
var dir = point_direction(x,y,Player.x,Player.y);
do
{

xx += lengthdir_x(1,dir);
yy += lengthdir_y(1,dir);

}
until(xx &gt; view_xview+6 and xx &lt; view_xview+view_wview-6 and yy &gt; view_yview+6 and yy &lt; view_yview+view_hview-6)
round(xx)
round(yy)
if inverted
draw_sprite(sprPortalIndicator,2,xx,yy);
else if type = 1
draw_sprite(sprPortalIndicator,0,xx,yy);
else if type = 2
draw_sprite(sprPortalIndicator,1,xx,yy);

}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///draw self
draw_self();
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
